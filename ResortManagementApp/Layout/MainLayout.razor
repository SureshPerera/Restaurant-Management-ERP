@using ResortManagementApp.Models.Auth.AuthDto

@inherits LayoutComponentBase
@inject Blazored.LocalStorage.ILocalStorageService localStorage

<link href="css/MainLayout.css" rel="stylesheet" />


<div class="page" style="font-family: cursive;">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main class="app-root">

        <!-- Top Navigation Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <img src="/imgs/maindashboard/logo.png" class="logo" />
                <span class="app-name">Solitary Green Resort</span>
            </div>

            <div class="topbar-center">
                <h4>Welcome, <span>@logerFName @logerLName</span></h4>
            </div>

            <div class="topbar-right">
                <LoginDisplay />
                <button class="logout-btn" @onclick="clickToLogout">
                    Logout
                </button>
            </div>
        </header>

        <!-- Background Section -->
        <section class="content-wrapper">
            <div class="background-overlay"></div>

            <div class="content-container">
                @Body
            </div>
        </section>

    </main>

</div>

<style>
    .bg-container {
        overflow: hidden;
    }

    .bg-overlay {
        position: absolute;
        inset: 0;
        background-image: url('/imgs/reservation/background.jpeg');
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        opacity: 0.3;
        z-index: 0;
    }
</style>
@inject NavigationManager navManager
@inject HttpClient http
@inject Blazored.LocalStorage.ILocalStorageService localStorage
@code {
    public string? logerFName;
    public string? logerLName;
    public RegistationRequstDto RegistrationRequistDto { get; set; } = new();
    protected async override Task OnInitializedAsync()
    {
        var UserloginId = await localStorage.GetItemAsync<Guid?>("Id");
        var regDate = await http.GetFromJsonAsync<RegistationRequstDto>($"https://localhost:4000/api/UserManagement/{UserloginId}");
        if(regDate != null)
        {
            logerFName = regDate.FirstName; 
            logerLName = regDate.LastName; 
        }
        Console.WriteLine("Err : not updated user name in main layout");

    }
    private async Task clickToLogout(MouseEventArgs args)
    {
        await localStorage.ClearAsync();
        Console.WriteLine("Logout succedfully..");
        navManager.NavigateTo("/Auth/Loging");


    }
}