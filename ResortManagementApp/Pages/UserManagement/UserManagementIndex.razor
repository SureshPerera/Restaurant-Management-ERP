@page "/UserManagement"
@using ResortManagementApp.Models.Auth
@using ResortManagementApp.Models.Auth.AuthDto
@using ResortManagementApp.Models.UserManagement
@using ResortManagementApp.Pages.ComponentCss
@layout MainLayout

<div class="container my-5">

    <!-- Header -->
    <div class="mb-4 text-center">
        <h2 class="fw-bold">User Management</h2>
        <p class="text-muted">Manage staff, roles, and access levels</p>
    </div>

    <!-- Top Controls -->
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
        <a href="/UserManagement/Create" class="btn btn-success shadow-sm">
            <i class="bi bi-person-plus-fill me-2"></i> Register User
        </a>

        <div class="search-box">
            <input @bind="Search" type="search" class="form-control shadow-sm" placeholder="🔍 Search by name, phone, NIC..." />
        </div>
    </div>

    <!-- User Table Card -->
    <div class="card user-table-card shadow-sm">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">Staff List</h5>
        </div>
        <div class="card-body p-0">
            @if (UserManagementDto == null || !UserManagementDto.Any())
            {
                <div class="text-muted p-4 text-center">
                    <Searching />
                    <p class="mt-2">No users found...</p>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table-hover mb-0 table align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>UserName</th>
                                <th>Name</th>
                                <th>Phone No</th>
                                <th>Access Level</th>
                                <th>Comments</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in UserManagementDto)
                            {
                                <tr>
                                    <td>@item.Email</td>
                                    <td>@(item.FirstName + " " + item.LastName)</td>
                                    <td>@item.PhoneNumber</td>
                                    <td>@item.AccessLevel</td>
                                    <td>
                                        <span class="badge bg-primary">@item.AccessLevel</span>
                                    </td>
                                    <td>@item.Comments</td>
                                    <td class="text-center">
                                        <a class="btn btn-sm btn-outline-primary me-2" title="Edit" href="/UserManagement/Edit/@item.Id">
                                            <i class="bi bi-pencil-square"></i>
                                        </a>
                                        <a class="btn btn-sm btn-outline-danger" title="Delete" href="/UserManagement/Delete/@item.Id">
                                            <i class="bi bi-trash-fill"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>

<style>
    /* Card Hover */
    .user-table-card {
        border-radius: 1rem;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .user-table-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

    /* Search box */
    .search-box input {
        border-radius: 2rem;
        padding: 0.6rem 1rem;
        max-width: 300px;
    }

    /* Table hover */
    .table-hover tbody tr:hover {
        background-color: #f1f9f4;
    }

    /* Action buttons */
    .btn-sm {
        border-radius: 50%;
        width: 36px;
        height: 36px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0;
    }
</style>
@inject HttpClient Http
@code {
    public List<RegistationRequstDto>? UserManagementDto { get; set; } = new();
    public string? Search { get; set; }

    // Example mock data
    protected async override void OnInitialized()
    {
        // UserManagementDto.Add(new UserManagementDto
        // {
        //     Id = Guid.NewGuid(),
        //     FirstName = "Gunadasa",
        //     LastName = "Perera",
        //     NIC = "200008136524",
        //     PhoneNumber = "0703914685",
        //     AccessLevel = "Staff",
        //     Comment = "Housekeeping Staff"
        // });

        // UserManagementDto.Add(new UserManagementDto
        // {
        //     Id = Guid.NewGuid(),
        //     FirstName = "Nimal",
        //     LastName = "Fernando",
        //     NIC = "199502534221",
        //     PhoneNumber = "0712345678",
        //     AccessLevel = "Admin",
        //     Comment = "System Administrator"
        // });
        try
        {
            UserManagementDto = await Http.GetFromJsonAsync<List<RegistationRequstDto>>("https://localhost:4000/api/Registation");
            Console.WriteLine("Pass");
            StateHasChanged();
        }
        catch (Exception ex)
        {
            Console.WriteLine("Error Massage : " + ex.Message);
        }
    }


}
