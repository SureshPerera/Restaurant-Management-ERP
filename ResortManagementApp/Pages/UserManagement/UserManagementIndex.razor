@page "/UserManagement"
@using ResortManagementApp.Models.Auth
@using ResortManagementApp.Models.Auth.AuthDto
@using ResortManagementApp.Models.UserManagement
@using ResortManagementApp.Pages.ComponentCss
@layout MainLayout

<div class="container my-5">

    <!-- Page Header -->
    <div class="mb-4 text-center">
        <h2 class="fw-bold rounded py-3 text-white"
            style="background-color:#344e41;">
            User Management
        </h2>
        <p style="color:whitesmoke" class="text-muted mt-2">Manage staff, roles, and access levels</p>
    </div>

    <!-- Top Action Bar -->
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
        <a href="/UserManagement/Create" class="btn btn-custom shadow-sm">
            <i class="bi bi-person-plus-fill me-2"></i> Register User
        </a>

        <input @bind="Search"
               type="search"
               class="form-control search-input shadow-sm"
               placeholder="🔍 Search by name, phone, NIC..." />
    </div>

    <!-- User Table Card -->
    <div class="card shadow-sm border-0">
        <div class="card-header table-header">
            Staff List
        </div>

        <div class="card-body p-0">
            @if (UserManagementDto == null || !UserManagementDto.Any())
            {
                <div class="text-center p-4 text-muted">
                    <Searching />
                    <p class="mt-2">No users found...</p>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead>
                            <tr>
                                <th style="width:60px;">No</th>
                                <th>User Name</th>
                                <th>Full Name</th>
                                <th>Phone</th>
                                <th>Access Level</th>
                                <th>Comments</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>

                        <tbody>
                            @foreach (var (item, index) in UserManagementDto.Select((value, i) => (value, i)))
                            {
                                <tr>
                                    <td class="fw-bold text-muted">@(index + 1)</td>
                                    <td>@item.UserName</td>
                                    <td>@($"{item.FirstName} {item.LastName}")</td>
                                    <td>@item.PhoneNumber</td>
                                    <td>
                                        <span class="badge bg-success">@item.AccessLevel</span>
                                    </td>
                                    <td>@item.Comments</td>
                                    <td class="text-center">
                                        <a class="btn btn-sm btn-edit"
                                           href="/UserManagement/Edit/@item.Id"
                                           title="Edit">
                                            <i class="bi bi-pencil-square"></i>
                                        </a>
                                        <a class="btn btn-sm btn-delete"
                                           href="/UserManagement/Delete/@item.Id"
                                           title="Delete">
                                            <i class="bi bi-trash-fill"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>

</div>

<style>
    body {
        background-color: #dad7cd;
    }

    /* Buttons */
    .btn-custom {
        background-color: #3a5a40;
        color: white;
        font-weight: bold;
        border-radius: 8px;
    }

        .btn-custom:hover {
            background-color: #588157;
            color: white;
        }

    /* Search */
    .search-input {
        max-width: 300px;
        border-radius: 20px;
        padding: 0.6rem 1rem;
    }

    /* Card */
    .card {
        border-radius: 12px;
    }

    /* Table Header */
    .table-header {
        background-color: #588157;
        color: white;
        font-weight: bold;
        font-size: 1rem;
    }

    table thead {
        background-color: #a3b18a;
        color: #344e41;
    }

    table tbody tr:nth-child(even) {
        background-color: #f8f9fa;
    }

    table tbody tr:hover {
        background-color: #e9f5ec;
    }

    /* Action Buttons */
    .btn-edit {
        background-color: #3a5a40;
        color: white;
        margin-right: 6px;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

        .btn-edit:hover {
            background-color: #588157;
        }

    .btn-delete {
        background-color: #c0392b;
        color: white;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

        .btn-delete:hover {
            background-color: #e74c3c;
        }
</style>
@inject HttpClient Http
@code {
    public List<RegistationRequstDto>? UserManagementDto { get; set; } = new();
    public string? Search { get; set; }

    // Example mock data
    protected async override void OnInitialized()
    {
        // UserManagementDto.Add(new UserManagementDto
        // {
        //     Id = Guid.NewGuid(),
        //     FirstName = "Gunadasa",
        //     LastName = "Perera",
        //     NIC = "200008136524",
        //     PhoneNumber = "0703914685",
        //     AccessLevel = "Staff",
        //     Comment = "Housekeeping Staff"
        // });

        // UserManagementDto.Add(new UserManagementDto
        // {
        //     Id = Guid.NewGuid(),
        //     FirstName = "Nimal",
        //     LastName = "Fernando",
        //     NIC = "199502534221",
        //     PhoneNumber = "0712345678",
        //     AccessLevel = "Admin",
        //     Comment = "System Administrator"
        // });
        try
        {
            UserManagementDto = await Http.GetFromJsonAsync<List<RegistationRequstDto>>("https://localhost:4000/api/UserManagement");
            Console.WriteLine("Pass");
            StateHasChanged();
        }
        catch (Exception ex)
        {
            Console.WriteLine("Error Massage : " + ex.Message);
        }
    }


}
