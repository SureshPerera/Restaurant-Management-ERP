@page "/Reservations"
@using ResortManagementApp.Models.Administration.ManageAgents
@using ResortManagementApp.Models.Reservation
@using ResortManagementApp.Models.Reservation.DTO
@using ResortManagementApp.Models.Reservation.OnlineBookingModel
@using ResortManagementApp.Pages.ComponentCss
@using ResortManagementApp.Pages.Reservations.OnlineBookingModelCrud
@inject HttpClient Http

@layout MainLayout

<div class="container my-4">

    <!-- Header -->
    <h3 class="mb-4 text-center">Reservation Management</h3>

    <div class="row g-4">

        <!-- Booking Type Buttons -->
        <div class="col-md-3 d-flex flex-column gap-3">
            <a href="/Reservations/DirectBooking" class="btn btn-primary">Direct Booking</a>
            <a href="/Reservations/AgentBooking" class="btn btn-primary">Agent Booking</a>
            <a href="/Reservations/OnlineBooking" class="btn btn-primary">Online Booking</a>

            <div class="d-grid mt-3 gap-2">
                <button class="btn btn-warning" @onclick="clickViewAll">View All Reservations</button>
                <button class="btn btn-warning" @onclick="clickAllConfirmedReservation">View All Confirmed Reservations</button>
                <button class="btn btn-warning" @onclick="clickAllTemporary">View All Temporary Reservations</button>
                <button class="btn btn-warning" @onclick="clickAllReservationByAgent">View All Reservations by Agent</button>
                <button class="btn btn-warning" @onclick="clickViewCancellations">View All Cancellations</button>
            </div>
        </div>

        <!-- Booking Lists -->
        <div class="col-md-9">

            <!-- Direct Booking Table -->
            <div class="mb-5">
                <h5>Direct Booking List</h5>
                @if (directBookingModels == null)
                {
                    <div class="d-flex justify-content-center"><Searching /></div>
                }
                else
                {
                    <div class="table-responsive rounded shadow-sm">
                        <table class="table-hover table">
                            <thead class="table-light text-center">
                                <tr style="background-color: #A3B18A; font-weight:bold;">
                                    <th>Name</th>
                                    <th>Phone Number</th>
                                    <th>Address</th>
                                    <th>Email Address</th>
                                    <th>NIC</th>
                                    <th>Customer Type</th>
                                    <th>Credit Limit</th>
                                    <th>Opening Balance</th>
                                    <th>Nationality</th>
                                    <th>Remark</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in directBookingModels)
                                {
                                    <tr class="table-light text-center" style="background-color: #DAD7CD;">
                                        <td>@($"{item.FirstName} {item.LastName}")</td>
                                        <td>@item.PhoneNumber</td>
                                        <td>@item.Address</td>
                                        <td>@item.EmailAddress</td>
                                        <td>@item.NIC</td>
                                        <td>@item.CustomerType</td>
                                        <td>@item.CreditLimit</td>
                                        <td>@item.OpeningBalanace</td>
                                        <td>@item.Nationality</td>
                                        <td>@item.Remark</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
            </div>

            <!-- Online Booking Table -->
            <div class="mb-5">
                <h5>Online Booking List</h5>
                @if (OnlineBookings == null)
                {
                    <div class="d-flex justify-content-center"><Searching /></div>
                }
                else
                {
                    <div class="table-responsive rounded shadow-sm">
                        <table class="table-hover table">
                            <thead class="table-light text-center">
                                <tr style="background-color: #A3B18A; font-weight:bold;">
                                    <th>Name</th>
                                    <th>Check-In Date</th>
                                    <th>Check-Out Date</th>
                                    <th>Rooms</th>
                                    <th>Adults</th>
                                    <th>Children</th>
                                    <th>Phone Number</th>
                                    <th>Email Address</th>
                                    <th>NIC</th>
                                    <th>Nationality</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in OnlineBookings)
                                {
                                    <tr class="table-light text-center" style="background-color: #DAD7CD;">
                                        <td>@($"{item.FirstName} {item.LastName}")</td>
                                        <td>@item.CheckInDate</td>
                                        <td>@item.CheckOutDate</td>
                                        <td>@item.NoOfRooms</td>
                                        <td>@item.NoOfAdults</td>
                                        <td>@item.NoOfChildren</td>
                                        <td>@item.PhoneNumber</td>
                                        <td>@item.EmailAddress</td>
                                        <td>@item.NIC</td>
                                        <td>@item.Nationality</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
            </div>

            <!-- Agent Booking Table -->
            <div class="mb-5">
                <h5>Agent Booking List</h5>
                @if (Agents == null)
                {
                    <div class="d-flex justify-content-center"><Searching /></div>
                }
                else
                {
                    <div class="table-responsive rounded shadow-sm">
                        <table class="table-hover table">
                            <thead class="table-light text-center">
                                <tr style="background-color: #A3B18A; font-weight:bold;">
                                    <th>Name</th>
                                    <th>Phone Number</th>
                                    <th>Address</th>
                                    <th>Email Address</th>
                                    <th>NIC</th>
                                    <th>Credit Limit</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Agents)
                                {
                                    <tr class="table-light text-center" style="background-color: #DAD7CD;">
                                        <td>@item.AgentName</td>
                                        <td>@item.Mobile</td>
                                        <td>@item.AgentAddress</td>
                                        <td>@item.Email</td>
                                        <td>@item.NIC</td>
                                        <td>@item.CreditLimit</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
            </div>

        </div>

    </div>
</div>


<style>
	label {
		color: white;
		background-color: black;
		font-size: 16px;
		font-weight: bold;
	}
</style>



@code {
    private List<DirectBookingModel>? directBookingModels = new List<DirectBookingModel>();
    private List<OnlineBookingModel>? OnlineBookings = new List<OnlineBookingModel>();
    private List<Agents>? Agents = new List<Agents>();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            directBookingModels = await Http.GetFromJsonAsync<List<DirectBookingModel>>("https://localhost:4000/api/DirectBooking");
            OnlineBookings = await Http.GetFromJsonAsync<List<OnlineBookingModel>>("https://localhost:4000/api/OnlineBooking");
            Agents = await Http.GetFromJsonAsync<List<Agents>>("https://localhost:4000/api/Agent");
            StateHasChanged();

        }
        catch (Exception ex)
        {
            Console.WriteLine("Error Massage : " + ex.Message);
        }
    }
    private async Task clickViewAll(MouseEventArgs args)
    {
        try
        {
            directBookingModels = await Http.GetFromJsonAsync<List<DirectBookingModel>>("https://localhost:4000/api/DirectBooking");
            OnlineBookings = await Http.GetFromJsonAsync<List<OnlineBookingModel>>("https://localhost:4000/api/OnlineBooking");
            Agents = await Http.GetFromJsonAsync<List<Agents>>("https://localhost:4000/api/Agent");
            StateHasChanged();

        }
        catch (Exception ex)
        {
            Console.WriteLine("Error Massage : " + ex.Message);
        }

    }
    private async Task clickAllConfirmedReservation(MouseEventArgs args)
    {
        var online = await Http.GetFromJsonAsync<List<OnlineBookingModel>>("https://localhost:4000/api/OnlineBooking");
        // Only confirmed bookings
        OnlineBookings = online?.Where(b => b.Conformation).ToList();
        var direct = await Http.GetFromJsonAsync<List<DirectBookingModel>>("https://localhost:4000/api/DirectBooking");

        directBookingModels = direct?.Where(a => a.Conformation).ToList();
        Console.WriteLine("Pass clickAllConfirmedReservation");
        StateHasChanged();
	}
    private  Task clickAllTemporary(MouseEventArgs args)
	{
		throw new NotImplementedException();
	}
    private  Task clickAllReservationByAgent(MouseEventArgs args)
	{
		throw new NotImplementedException();
	}
    private  Task clickViewCancellations(MouseEventArgs args)
	{
		throw new NotImplementedException();
	}
}
