@page "/SmartSalesBilling"
@using ResortManagementApp.Models.Administration.DTOS
@using ResortManagementApp.Models.SmartSales
@using ResortManagementApp.Models.SmartSales.Dtos
@layout MainLayout

<div class="container-fluid p-4">

    <!-- Page Header -->
    <div class="mb-4 text-center">
        <h2 class="fw-bold">Smart Sales Manager (Expenses)</h2>
        <a href="/SmartSelling/Create" class="btn btn-primary mt-2">Make Sale</a>
    </div>

    <!-- Summary Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="card summary-card daily p-3 shadow-sm">
                <h5>Today's Sale</h5>
                <h3 class="fw-bold text-success">Rs @TodaySaleSum</h3>
                <p class="text-muted">Total sale today</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card summary-card monthly p-3 shadow-sm">
                <h5>This Month</h5>
                <h3 class="fw-bold text-info">Rs @MonthSaleSum</h3>
                <p class="text-muted">Total sale this month</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card summary-card yearly p-3 shadow-sm">
                <h5>This Year</h5>
                <h3 class="fw-bold text-warning">Rs @YearSaleSum</h3>
                <p class="text-muted">Total sale this year</p>
            </div>
        </div>
    </div>

    <!-- Expense Table -->
    <div class="card p-3 shadow-sm">
        <h5 class="fw-bold mb-3">Expense Details</h5>
        <div class="table-responsive">
            <table class="table-hover table align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Sandry Item</th>
                        <th>Unit Price</th>
                        <th>Discouunt</th>
                        <th>Quantity</th>
                        <th>Total (LKR)</th>
                        <th>Remark</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if(SmartSale != null)
                    {
                        @foreach (var item in SmartSale!)
                        {
                            <tr>
                                <td>@item.SandryItem</td>
                                <td>@item.UnitPrice</td>
                                <td>@item.Discuount</td>
                                <td>@item.Quantity</td>
                                <td>@item.TotalLKR</td>
                                <td>@item.Remark</td>
                                <td class="text-center">
                                    <a class="btn btn-sm btn-outline-primary me-2" title="Edit" href="/UserManagement/Edit">
                                        <i class="bi bi-pencil-square"></i>
                                    </a>
                                    <a class="btn btn-sm btn-outline-danger" title="Delete" href="/UserManagement/Delete">
                                        <i class="bi bi-trash-fill"></i>
                                    </a>
                                </td>
                            </tr>
                        }
                    }      
                </tbody>
            </table>
        </div>
    </div>

    <!-- Optional Chart Section -->
    <div class="card mt-4 p-3 shadow-sm">
        <h5 class="fw-bold mb-3">Sales Trend</h5>
        <div>
            @* You can add a chart here using a Blazor chart library (e.g., ChartJs.Blazor, MudBlazor charts) *@
            <p class="text-muted">[Sales chart will be here]</p>
        </div>
    </div>

</div>

<style>
    /* Summary Cards */
    .summary-card {
        border-radius: 1rem;
        color: white;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .summary-card.daily {
            background: linear-gradient(135deg, #588157, #344E41);
        }

        .summary-card.monthly {
            background: linear-gradient(135deg, #0dcaf0, #198754);
        }

        .summary-card.yearly {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

    /* Table */
    .table-hover tbody tr:hover {
        background-color: #f1f1f1;
        cursor: pointer;
    }

    .table-responsive {
        overflow-x: auto;
    }
</style>
@inject HttpClient Http
@code {
    // Placeholder properties, replace with dynamic data from API or DB
    private decimal todaySale = 25000;
    private decimal monthSale = 750000;
    private decimal yearSale = 9500000;
    public List<SmartSale>? SmartSale { get; set; } = new();
    public List<SmartSale>? SmartSales { get; set; } = new();
    public SmartSaleDto SmartSaleDto { get; set; } = new();
    public double TodaySaleSum;
    public double MonthSaleSum;
    public double YearSaleSum;

    protected override async Task OnInitializedAsync()
    {
        SmartSale = await Http.GetFromJsonAsync<List<SmartSale>>("https://localhost:4000/api/SmartSale");
        var today = DateTime.Today;
        var tomorrow = today.AddDays(1);
        TodaySaleSum = SmartSale
                        .Where(x => x.CreateDate >= today && x.CreateDate < tomorrow)
                        .Sum(x => x.TotalLKR);

        var monthStart = new DateTime(today.Year, today.Month, 1);
        Console.WriteLine("Month Start :"+ monthStart);
        var monthEnd = monthStart.AddMonths(1);
        Console.WriteLine("Month Start :"+ monthEnd);
        MonthSaleSum = SmartSale
                        .Where(x => x.CreateDate >= monthStart && x.CreateDate < monthEnd)
                        .Sum(x => x.TotalLKR);
        
        var yearStart = new DateTime(today.Year, 1, 1);
        Console.WriteLine("Year Start :"+ yearStart);
        var yearEnd = new DateTime(today.Year + 1, 1, 1);
        Console.WriteLine("Year End :"+ yearEnd);
        YearSaleSum = SmartSale
                        .Where(x => x.CreateDate >= yearStart && x.CreateDate < yearEnd)
                        .Sum(x => x.TotalLKR);
    }
    
}
