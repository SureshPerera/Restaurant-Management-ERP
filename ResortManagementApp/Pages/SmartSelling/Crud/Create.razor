@page "/SmartSelling/Create"
@inject ISnackbar Snackbar

@using MudBlazor
@using ResortManagementApp.Models.SmartSales
@using ResortManagementApp.Models.SmartSales.Dtos
@using System.Text.Json.Nodes
@layout MainLayout

<div class="container my-4">

    <!-- Card Container -->
    <div class="card rounded-4 border-0 p-4 shadow-sm">
        <h3 class="mb-4 text-center" style="color:#344e41;">Add Expense</h3>

        @if (SmartSaleDto == null)
        {
            <div class="text-muted py-5 text-center">
                <em>Loading expense details...</em>
            </div>
        }
        else
        {
            <!-- Expense Form -->
            <div class="row g-3">

                <!-- Sundry Item -->
                <div class="col-md-6">
                    <label class="form-label fw-bold">Sundry Item</label>
                    <input class="form-control shadow-sm" type="text" @bind="SmartSaleDto.SandryItem" placeholder="Enter item name" />
                    <span class="text-danger">@Errors["SandryItem"]?[0]</span>
                </div>

                <!-- Unit Price -->
                <div class="col-md-3">
                    <label class="form-label fw-bold">Unit Price</label>
                    <input class="form-control shadow-sm" type="number" @bind="SmartSaleDto.UnitPrice" />
                    <span class="text-danger">@Errors["UnitPrice"]?[0]</span>
                </div>

                <!-- Quantity -->
                <div class="col-md-3">
                    <label class="form-label fw-bold">Quantity</label>
                    <input class="form-control shadow-sm" type="number" @bind="SmartSaleDto.Quantity" />
                    <span class="text-danger">@Errors["Quantity"]?[0]</span>
                </div>

                <!-- Total (Calculated) -->
                <div class="col-md-4">
                    <label class="form-label fw-bold">Total</label>
                    <input class="form-control shadow-sm" type="text" value="@(SmartSaleDto.Quantity* SmartSaleDto.UnitPrice)" readonly />
                </div>

                <!-- Remark -->
                <div class="col-md-4">
                    <label class="form-label fw-bold">Remark</label>
                    <input class="form-control shadow-sm" type="text" @bind="SmartSaleDto.Remark" placeholder="Optional remark" />
                </div>

                <!-- Discount -->
                <div class="col-md-4">
                    <label class="form-label fw-bold">Discount (%)</label>
                    <input class="form-control shadow-sm" type="number" @bind="SmartSaleDto.Discouunt" placeholder="Enter discount" />
                </div>

            </div>

            <!-- Summary Card -->
            <div class="card rounded-4 mt-4 border-0 p-3 shadow-sm" style="background-color:#fefae0;">
                <h5 class="fw-bold mb-3 text-center">Expense Summary</h5>

                @{
                    var subTotal = SmartSaleDto.Quantity * SmartSaleDto.UnitPrice;
                    var grandTotal = subTotal - SmartSaleDto.Discouunt;
                    SmartSaleDto.TotalLKR = grandTotal;
                }

                <div class="row g-3 text-center">
                    <div class="col-md-4">
                        <div class="card rounded-3 py-3 shadow-sm">
                            <p class="fw-bold mb-1">Item</p>
                            <p class="mb-0">@SmartSaleDto.SandryItem</p>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card rounded-3 py-3 shadow-sm">
                            <p class="fw-bold mb-1">Sub Total</p>
                            <p class="mb-0">Rs @subTotal</p>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card rounded-3 bg-success py-3 text-white shadow-sm">
                            <p class="fw-bold mb-1">Grand Total</p>
                            <p class="fs-5 mb-0">@grandTotal Rs</p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Action Buttons -->
            <div class="d-flex justify-content-center mt-4 gap-3">
                <button class="btn btn-success fw-bold px-4" @onclick="CreateExpence">Save</button>
                <button class="btn btn-warning fw-bold px-4" type="reset">Clear</button>
                <a class="btn btn-primary fw-bold px-4" href="/SmartSalesBilling">Back</a>
            </div>
        }
    </div>
</div>

<style>
    .form-label {
        font-weight: bold;
    }

    .shadow-sm {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }

    .card > .card {
        border: none;
    }
</style>

@code {
    public JsonNode Errors { get; set; } = new JsonObject();
    public SmartSaleDto SmartSaleDto { get; set; } = new();

    public void HandleUnConfirmClick(string message)
    {
        Snackbar.Configuration.PositionClass = Defaults.Classes.Position.TopRight;
        Snackbar.Configuration.MaxDisplayedSnackbars = 10;
        Snackbar.Add(message, Severity.Normal, config =>
        {
            config.ShowCloseIcon = false;
            config.SnackbarVariant = Variant.Filled;
        });
    }
    private Task CreateExpence(MouseEventArgs args)
    {
        throw new NotImplementedException();
    }
}
