@page "/Administration/ReportAnalysis"

@using ResortManagementApp.Models.Reservation
@using ResortManagementApp.Models.Reservation.OnlineBookingModel
@using ResortManagementApp.Pages.ComponentCss
@layout MainLayout
<link href="css/report.css" rel="stylesheet" />

<div class="container my-4">

	<!-- Page Header -->
	<div class="mb-4 text-center">
		<h2 class="fw-bold rounded py-3 text-white" style="background-color:#344e41;">
			Manage Report & Analysis
		</h2>
	</div>

	<div class="row g-4">

		<!-- Action Panel and Date Filters -->
		<div class="card shadow-sm p-3 mb-4">
			<div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-3">

				<!-- Action Buttons -->
				<div class="d-flex flex-wrap gap-2">
					<a href="/Administration/ReportAnalysis/Create" class="btn btn-custom">
						+ New Report
					</a>
					<a href="/Administration" class="btn btn-action">
						← Back
					</a>
				</div>

				<!-- Date Filters -->
				<div class="d-flex flex-wrap gap-2 align-items-center">
					<div class="date-box">
						<label>From:</label>
						<input type="date" class="form-control mb-2" placeholder="From" @bind="FromDate" />
					</div>
					<div class="date-box">
						<label>To:</label>
						<input type="date" class="form-control mb-2" placeholder="To" @bind="ToDate" />
					</div>
					<div class="text-danger">
						@erroMassage
					</div>
				</div>
			</div>

			<!-- Report Buttons -->
			<div class="d-flex flex-wrap gap-2">
				<button @onclick="clickAgentRport" class="btn btn-secondary">Agent Statistics Report</button>
				<button @onclick="clickLocalClientRport" class="btn btn-secondary">Local Client Statistics Report</button>
				<button @onclick="clickForeignClientRport" class="btn btn-secondary">Foreign Client Statistics Report</button>
				<button @onclick="clickAllBookingClientRport" class="btn btn-secondary">All Booking By Another Master Id</button>
				<button @onclick="clickAllTransactionClientRport" class="btn btn-secondary">All Transaction by Pay Id</button>
			</div>
		</div>

	</div>
</div>
@{
	int counter = 1;
}

@switch (SelectBtn)
{
	case 2:
		<div>
			@if (DirectBookingModel != null)
			{
				<div>
					@if (DirectBookingModel == null)
					{
						<p>Loading...</p>
					}
					else if (!DirectBookingModel.Any())
					{
						<p>No local clients found.</p>
					}
					else
					{
						<table class="table table-bordered table-striped" style=" color:whitesmoke ">
							<thead class="table-dark">
								<tr>
									<th>No</th>
									<th>Name</th>
									<th>Phone Number</th>
									<th>BirthDay</th>
									<th>Address</th>
									<th>Email</th>
									<th>NIC</th>
									<th>Opening Balace</th>
									<th>Remark</th>
									<th>Check In Date</th>
									<th>Check Out Date</th>
									<th>Check In Time</th>
									<th>Check Out Time</th>

								</tr>
							</thead>

							<tbody style="background-image: url('/imgs/maindashboard/logo.png');
							background-color:seagreen;
				            background-size: cover;
				            background-repeat: no-repeat;
				            padding: 20px;
				            border-radius: 10px;">
								@foreach (var item in localClientsDirect!)
								{
									<tr style=" color:whitesmoke ">
										<th>@counter</th>
										<th>@item.FirstName @item.LastName</th>
										<th>@item.PhoneNumber </th>
										<th>@item.DathOfBirth</th>
										<th>@item.Address</th>
										<th>@item.EmailAddress</th>
										<th>@item.NIC</th>
										<th>@item.OpeningBalanace </th>
										<th>@item.Remark</th>
										<th>@item.CheckInDate.Date </th>
										<th>@item.CheckOutDate.Date </th>
										<th>@item.CheckInTime  </th>
										<th>@item.CheckOutTime  </th>
										
									</tr>
								}
								@foreach (var item in LocalClientsOnline!)
								{
									<tr style=" color:whitesmoke ">
										<th>@counter</th>
										<th>@item.FirstName @item.LastName</th>
										<th>@item.PhoneNumber </th>
										<th>@item.DathOfBirth</th>
										<th>@item.Address</th>
										<th>@item.EmailAddress</th>
										<th>@item.NIC</th>
										<th>@item.OpeningBalanace </th>
										<th>@item.Remark</th>
										<th>@item.CheckInDate </th>
										<th>@item.CheckOutDate </th>
										<th>@item.CheckInTime  </th>
										<th>@item.CheckOutTime  </th>

									</tr>
								}
							</tbody>
						</table>
					}
				</div>
			}

		</div>
		break;
		case 3 :
		<div>
			<div>
					@if (DirectBookingModel == null)
					{
						<p>Loading...</p>
					}
					else if (!DirectBookingModel.Any())
					{
						<p>No local clients found.</p>
					}
					else
					{
						<table class="table table-bordered table-striped">
							<thead class="table-dark">
								<tr>
									<th>No</th>
									<th>Name</th>
									<th>Phone Number</th>
									<th>BirthDay</th>
									<th>Address</th>
									<th>Email</th>
									<th>NIC</th>
									<th>Opening Balace</th>
									<th>Remark</th>
									<th>Check In Date</th>
									<th>Check Out Date</th>
									<th>Check In Time</th>
									<th>Check Out Time</th>

								</tr>
							</thead>

						<tbody tyle="background-image: url('/imgs/maindashboard/logo.png');
										background-color:seagreen;
							            background-size: cover;
							            background-repeat: no-repeat;
							            padding: 20px;
							            border-radius: 10px;">
							@foreach (var item in ForgnClientsDirect!)
								{
								<tr style=" color:whitesmoke ">
									<th>@counter</th>
										<th>@item.FirstName @item.LastName</th>
										<th>@item.PhoneNumber </th>
										<th>@item.DathOfBirth</th>
										<th>@item.Address</th>
										<th>@item.EmailAddress</th>
										<th>@item.NIC</th>
										<th>@item.OpeningBalanace </th>
										<th>@item.Remark</th>
										<th>@item.CheckInDate.Date </th>
										<th>@item.CheckOutDate.Date </th>
										<th>@item.CheckInTime  </th>
										<th>@item.CheckOutTime  </th>

									</tr>
								}
							@foreach (var item in ForgnClientsOnline!)
								{
								<tr style=" color:whitesmoke ">
									<th>@counter</th>
										<th>@item.FirstName @item.LastName</th>
										<th>@item.PhoneNumber </th>
										<th>@item.DathOfBirth</th>
										<th>@item.Address</th>
										<th>@item.EmailAddress</th>
										<th>@item.NIC</th>
										<th>@item.OpeningBalanace </th>
										<th>@item.Remark</th>
										<th>@item.CheckInDate </th>
										<th>@item.CheckOutDate </th>
										<th>@item.CheckInTime  </th>
										<th>@item.CheckOutTime  </th>

									</tr>
								}
							</tbody>
						</table>
					}
				</div>
			

		</div>
		break;
}


@inject HttpClient http
@code {
	public List<DirectBookingModel>? DirectBookingModel { get; set; } = new();
	public List<OnlineBookingModel>? OnlineBookingModel { get; set; } = new();
	public List<DirectBookingModel>? localClientsDirect { get; set; } = new();
	public List<DirectBookingModel>? ForgnClientsDirect { get; set; } = new();
	public List<OnlineBookingModel>? LocalClientsOnline { get; set; } = new();
	public List<OnlineBookingModel>? ForgnClientsOnline { get; set; } = new();
	public int SelectBtn = 0;
	public bool showDatePopup;
	public bool Load;
	public DateTime FromDate = DateTime.Today;
	public DateTime ToDate = DateTime.Today;
	public string? erroMassage = "";
	public int No = 0;
	protected override void OnInitialized()
	{

	}



	private Task clickAgentRport(MouseEventArgs args)
	{
		throw new NotImplementedException();
	}
	private async Task clickLocalClientRport(MouseEventArgs args)
	{
		showDatePopup = true;
		
			SelectBtn = 2;
			Console.WriteLine(SelectBtn);
			DirectBookingModel = await http.GetFromJsonAsync<List<DirectBookingModel>>("https://localhost:4000/api/DirectBooking");
			localClientsDirect = DirectBookingModel!
											.Where(x => x.CustomerType == "Local" )
												.ToList();
			OnlineBookingModel = await http.GetFromJsonAsync<List<OnlineBookingModel>>("https://localhost:4000/api/OnlineBooking");
			LocalClientsOnline = OnlineBookingModel!
											.Where(x => x.CustomerType == "Local")
												.ToList();
		
												 
	}
	private async Task clickForeignClientRport(MouseEventArgs args)
	{
		SelectBtn = 3;
		Console.WriteLine(SelectBtn);

		DirectBookingModel = await http.GetFromJsonAsync<List<DirectBookingModel>>("https://localhost:4000/api/DirectBooking");
		ForgnClientsDirect = DirectBookingModel!
											.Where(x => x.CustomerType == "Foreign")
											.ToList();
		OnlineBookingModel = await http.GetFromJsonAsync<List<OnlineBookingModel>>("https://localhost:4000/api/OnlineBooking");
		ForgnClientsOnline = OnlineBookingModel!
											.Where(x => x.CustomerType == "Foreign")
											.ToList();
	}
	private Task clickAllBookingClientRport(MouseEventArgs args)
	{
		throw new NotImplementedException();
	}
	private Task clickAllTransactionClientRport(MouseEventArgs args)
	{
		throw new NotImplementedException();
	}
	
}
